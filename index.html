	<!DOCTYPE html>
	<html lang="zh-CN">
	<head>
	    <meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <title>机器人后台管理系统</title>
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
	    <style>
	        body {
	            background-color: #f8f9fa;
	            font-family: 'Microsoft YaHei', sans-serif;
	        }
	        .sidebar {
	            min-height: 100vh;
	            background-color: #343a40;
	            color: white;
	        }
	        .sidebar .nav-link {
	            color: rgba(255, 255, 255, 0.8);
	            border-radius: 0.375rem;
	            margin-bottom: 0.25rem;
	        }
	        .sidebar .nav-link:hover {
	            background-color: rgba(255, 255, 255, 0.1);
	            color: white;
	        }
	        .sidebar .nav-link.active {
	            background-color: #0d6efd;
	            color: white;
	        }
	        .content {
	            padding: 20px;
	        }
	        .card {
	            margin-bottom: 20px;
	            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
	        }
	        .table-responsive {
	            border-radius: 0.375rem;
	        }
	        .btn-action {
	            margin-right: 5px;
	        }
	        .login-container {
	            max-width: 400px;
	            margin: 100px auto;
	            padding: 30px;
	            background-color: white;
	            border-radius: 0.5rem;
	            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
	        }
	        .login-title {
	            text-align: center;
	            margin-bottom: 30px;
	        }
	        .stat-card {
	            border-left: 4px solid #0d6efd;
	        }
	        .modal-header {
	            background-color: #f8f9fa;
	            border-bottom: 1px solid #dee2e6;
	        }
	        .form-label {
	            font-weight: 500;
	        }
	        .pagination {
	            margin-top: 20px;
	        }
	        .search-box {
	            margin-bottom: 20px;
	        }
	        .alert-container {
	            position: fixed;
	            top: 20px;
	            right: 20px;
	            z-index: 1050;
	            max-width: 350px;
	        }
	        .loading-spinner {
	            display: none;
	            position: fixed;
	            top: 0;
	            left: 0;
	            width: 100%;
	            height: 100%;
	            background-color: rgba(0, 0, 0, 0.5);
	            z-index: 9999;
	            justify-content: center;
	            align-items: center;
	        }
	        .loading-spinner .spinner-border {
	            width: 3rem;
	            height: 3rem;
	        }
	        .status-active {
	            color: #2ecc71;
	            font-weight: bold;
	        }
	        .status-inactive {
	            color: #e74c3c;
	            font-weight: bold;
	        }
	    </style>
	</head>
	<body>
	    <!-- 加载动画 -->
	    <div class="loading-spinner" id="loadingSpinner">
	        <div class="spinner-border text-primary" role="status">
	            <span class="visually-hidden">加载中...</span>
	        </div>
	    </div>
	    <!-- 登录界面 -->
	    <div class="login-container" id="loginContainer">
	        <h2 class="login-title">机器人后台管理系统</h2>
	        <div class="mb-3">
	            <label for="adminKey" class="form-label">管理员密钥</label>
	            <input type="password" class="form-control" id="adminKey" placeholder="请输入管理员密钥">
	        </div>
	        <button class="btn btn-primary w-100" onclick="login()">登录</button>
	        <div class="mt-3 text-center">
	            <small class="text-muted">请输入正确的管理员密钥以继续</small>
	        </div>
	    </div>
	    <!-- 主界面 -->
	    <div class="container-fluid" id="mainContainer" style="display: none;">
	        <div class="row">
	            <!-- 侧边栏 -->
	            <div class="col-md-3 col-lg-2 sidebar p-0">
	                <div class="d-flex flex-column p-3">
	                    <h4 class="mb-4">管理菜单</h4>
	                    <ul class="nav nav-pills flex-column mb-auto">
	                        <li class="nav-item">
	                            <a href="#" class="nav-link active" onclick="showSection('dashboard')">
	                                <i class="bi bi-speedometer2 me-2"></i> 仪表盘
	                            </a>
	                        </li>
	                        <li class="nav-item">
	                            <a href="#" class="nav-link" onclick="showSection('users')">
	                                <i class="bi bi-people me-2"></i> 用户管理
	                            </a>
	                        </li>
	                        <li class="nav-item">
	                            <a href="#" class="nav-link" onclick="showSection('teachers')">
	                                <i class="bi bi-person-badge me-2"></i> 老师管理
	                            </a>
	                        </li>
	                        <li class="nav-item">
	                            <a href="#" class="nav-link" onclick="showSection('keywords')">
	                                <i class="bi bi-key me-2"></i> 关键词管理
	                            </a>
	                        </li>
	                        <li class="nav-item">
	                            <a href="#" class="nav-link" onclick="showSection('banned')">
	                                <i class="bi bi-shield-x me-2"></i> 禁言词管理
	                            </a>
	                        </li>
	                        <li class="nav-item">
	                            <a href="#" class="nav-link" onclick="showSection('scheduled')">
	                                <i class="bi bi-clock-history me-2"></i> 定时发送任务
	                            </a>
	                        </li>
	                        <li class="nav-item">
	                            <a href="#" class="nav-link" onclick="showSection('settings')">
	                                <i class="bi bi-gear me-2"></i> 系统设置
	                            </a>
	                        </li>
	                    </ul>
	                    <hr>
	                    <div class="dropdown">
	                        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
	                            <i class="bi bi-person-circle me-2"></i>
	                            <strong>管理员</strong>
	                        </a>
	                        <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdownUser1">
	                            <li><a class="dropdown-item" href="#" onclick="logout()">退出登录</a></li>
	                        </ul>
	                    </div>
	                </div>
	            </div>
	            <!-- 主内容区 -->
	            <div class="col-md-9 col-lg-10 content">
	                <!-- 仪表盘 -->
	                <div id="dashboardSection" class="content-section">
	                    <h2 class="mb-4">仪表盘</h2>
	                    <div class="row">
	                        <div class="col-md-3 mb-4">
	                            <div class="card stat-card">
	                                <div class="card-body">
	                                    <h5 class="card-title">用户总数</h5>
	                                    <h2 class="text-primary" id="totalUsers">-</h2>
	                                    <p class="card-text">注册用户数量</p>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="col-md-3 mb-4">
	                            <div class="card stat-card">
	                                <div class="card-body">
	                                    <h5 class="card-title">老师总数</h5>
	                                    <h2 class="text-success" id="totalTeachers">-</h2>
	                                    <p class="card-text">已注册老师数量</p>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="col-md-3 mb-4">
	                            <div class="card stat-card">
	                                <div class="card-body">
	                                    <h5 class="card-title">关键词总数</h5>
	                                    <h2 class="text-warning" id="totalKeywords">-</h2>
	                                    <p class="card-text">已设置关键词数量</p>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="col-md-3 mb-4">
	                            <div class="card stat-card">
	                                <div class="card-body">
	                                    <h5 class="card-title">禁言词总数</h5>
	                                    <h2 class="text-danger" id="totalBanned">-</h2>
	                                    <p class="card-text">已设置禁言词数量</p>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                    <div class="row">
	                        <div class="col-md-6 mb-4">
	                            <div class="card">
	                                <div class="card-header">
	                                    <h5>最近用户</h5>
	                                </div>
	                                <div class="card-body">
	                                    <div class="table-responsive">
	                                        <table class="table table-hover">
	                                            <thead>
	                                                <tr>
	                                                    <th>ID</th>
	                                                    <th>用户名</th>
	                                                    <th>积分</th>
	                                                    <th>最后签到</th>
	                                                </tr>
	                                            </thead>
	                                            <tbody id="recentUsers">
	                                                <tr>
	                                                    <td colspan="4" class="text-center">加载中...</td>
	                                                </tr>
	                                            </tbody>
	                                        </table>
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="col-md-6 mb-4">
	                            <div class="card">
	                                <div class="card-header">
	                                    <h5>最近老师</h5>
	                                </div>
	                                <div class="card-body">
	                                    <div class="table-responsive">
	                                        <table class="table table-hover">
	                                            <thead>
	                                                <tr>
	                                                    <th>花名</th>
	                                                    <th>年龄</th>
	                                                    <th>地区</th>
	                                                    <th>状态</th>
	                                                </tr>
	                                            </thead>
	                                            <tbody id="recentTeachers">
	                                                <tr>
	                                                    <td colspan="4" class="text-center">加载中...</td>
	                                                </tr>
	                                            </tbody>
	                                        </table>
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	                <!-- 用户管理 -->
	                <div id="usersSection" class="content-section" style="display: none;">
	                    <div class="d-flex justify-content-between align-items-center mb-4">
	                        <h2>用户管理</h2>
	                        <div>
	                            <button class="btn btn-success" onclick="showAddUserModal()">
	                                <i class="bi bi-plus-circle me-1"></i> 添加用户
	                            </button>
	                        </div>
	                    </div>
	                    <div class="card">
	                        <div class="card-body">
	                            <div class="search-box">
	                                <div class="input-group">
	                                    <input type="text" class="form-control" placeholder="搜索用户..." id="userSearch">
	                                    <button class="btn btn-outline-secondary" type="button" onclick="searchUsers()">
	                                        <i class="bi bi-search"></i>
	                                    </button>
	                                </div>
	                            </div>
	                            <div class="table-responsive">
	                                <table class="table table-hover">
	                                    <thead>
	                                        <tr>
	                                            <th>ID</th>
	                                            <th>用户名</th>
	                                            <th>显示名称</th>
	                                            <th>积分</th>
	                                            <th>消息数</th>
	                                            <th>最后签到</th>
	                                            <th>操作</th>
	                                        </tr>
	                                    </thead>
	                                    <tbody id="usersTable">
	                                        <tr>
	                                            <td colspan="7" class="text-center">加载中...</td>
	                                        </tr>
	                                    </tbody>
	                                </table>
	                            </div>
	                            <nav aria-label="Page navigation">
	                                <ul class="pagination justify-content-center" id="usersPagination">
	                                    <!-- 分页按钮将通过JS动态生成 -->
	                                </ul>
	                            </nav>
	                        </div>
	                    </div>
	                </div>
	                <!-- 老师管理 -->
	                <div id="teachersSection" class="content-section" style="display: none;">
	                    <div class="d-flex justify-content-between align-items-center mb-4">
	                        <h2>老师管理</h2>
	                        <div>
	                            <button class="btn btn-success" onclick="showAddTeacherModal()">
	                                <i class="bi bi-plus-circle me-1"></i> 添加老师
	                            </button>
	                        </div>
	                    </div>
	                    <div class="card">
	                        <div class="card-body">
	                            <div class="search-box">
	                                <div class="input-group">
	                                    <input type="text" class="form-control" placeholder="搜索老师..." id="teacherSearch">
	                                    <button class="btn btn-outline-secondary" type="button" onclick="searchTeachers()">
	                                        <i class="bi bi-search"></i>
	                                    </button>
	                                </div>
	                            </div>
	                            <div class="table-responsive">
	                                <table class="table table-hover">
	                                    <thead>
	                                        <tr>
	                                            <th>ID</th>
	                                            <th>花名</th>
	                                            <th>年龄</th>
	                                            <th>地区</th>
	                                            <th>账号</th>
	                                            <th>服务类型</th>
	                                            <th>状态</th>
	                                            <th>操作</th>
	                                        </tr>
	                                    </thead>
	                                    <tbody id="teachersTable">
	                                        <tr>
	                                            <td colspan="8" class="text-center">加载中...</td>
	                                        </tr>
	                                    </tbody>
	                                </table>
	                            </div>
	                            <nav aria-label="Page navigation">
	                                <ul class="pagination justify-content-center" id="teachersPagination">
	                                    <!-- 分页按钮将通过JS动态生成 -->
	                                </ul>
	                            </nav>
	                        </div>
	                    </div>
	                </div>
	                <!-- 关键词管理 -->
	                <div id="keywordsSection" class="content-section" style="display: none;">
	                    <div class="d-flex justify-content-between align-items-center mb-4">
	                        <h2>关键词管理</h2>
	                        <div>
	                            <button class="btn btn-success" onclick="showAddKeywordModal()">
	                                <i class="bi bi-plus-circle me-1"></i> 添加关键词
	                            </button>
	                        </div>
	                    </div>
	                    <div class="card">
	                        <div class="card-body">
	                            <div class="search-box">
	                                <div class="input-group">
	                                    <input type="text" class="form-control" placeholder="搜索关键词..." id="keywordSearch">
	                                    <button class="btn btn-outline-secondary" type="button" onclick="searchKeywords()">
	                                        <i class="bi bi-search"></i>
	                                    </button>
	                                </div>
	                            </div>
	                            <div class="table-responsive">
	                                <table class="table table-hover">
	                                    <thead>
	                                        <tr>
	                                            <th>ID</th>
	                                            <th>关键词</th>
	                                            <th>回复内容</th>
	                                            <th>自定义回复</th>
	                                            <th>状态</th>
	                                            <th>操作</th>
	                                        </tr>
	                                    </thead>
	                                    <tbody id="keywordsTable">
	                                        <tr>
	                                            <td colspan="6" class="text-center">加载中...</td>
	                                        </tr>
	                                    </tbody>
	                                </table>
	                            </div>
	                            <nav aria-label="Page navigation">
	                                <ul class="pagination justify-content-center" id="keywordsPagination">
	                                    <!-- 分页按钮将通过JS动态生成 -->
	                                </ul>
	                            </nav>
	                        </div>
	                    </div>
	                </div>
	                <!-- 禁言词管理 -->
	                <div id="bannedSection" class="content-section" style="display: none;">
	                    <div class="d-flex justify-content-between align-items-center mb-4">
	                        <h2>禁言词管理</h2>
	                        <div>
	                            <button class="btn btn-success" onclick="showAddBannedModal()">
	                                <i class="bi bi-plus-circle me-1"></i> 添加禁言词
	                            </button>
	                        </div>
	                    </div>
	                    <div class="card">
	                        <div class="card-body">
	                            <div class="search-box">
	                                <div class="input-group">
	                                    <input type="text" class="form-control" placeholder="搜索禁言词..." id="bannedSearch">
	                                    <button class="btn btn-outline-secondary" type="button" onclick="searchBanned()">
	                                        <i class="bi bi-search"></i>
	                                    </button>
	                                </div>
	                            </div>
	                            <div class="table-responsive">
	                                <table class="table table-hover">
	                                    <thead>
	                                        <tr>
	                                            <th>ID</th>
	                                            <th>禁言词</th>
	                                            <th>操作</th>
	                                        </tr>
	                                    </thead>
	                                    <tbody id="bannedTable">
	                                        <tr>
	                                            <td colspan="3" class="text-center">加载中...</td>
	                                        </tr>
	                                    </tbody>
	                                </table>
	                            </div>
	                            <nav aria-label="Page navigation">
	                                <ul class="pagination justify-content-center" id="bannedPagination">
	                                    <!-- 分页按钮将通过JS动态生成 -->
	                                </ul>
	                            </nav>
	                        </div>
	                    </div>
	                </div>
	                <!-- 定时发送任务 -->
	                <div id="scheduledSection" class="content-section" style="display: none;">
	                    <div class="d-flex justify-content-between align-items-center mb-4">
	                        <h2>定时发送任务管理</h2>
	                        <div>
	                            <button class="btn btn-success" onclick="showAddScheduledTaskModal()">
	                                <i class="bi bi-plus-circle me-1"></i> 添加定时任务
	                            </button>
	                            <button class="btn btn-primary" onclick="refreshScheduledTasks()">
	                                <i class="bi bi-arrow-clockwise me-1"></i> 刷新列表
	                            </button>
	                        </div>
	                    </div>
	                    <div class="card">
	                        <div class="card-body">
	                            <div class="search-box">
	                                <div class="input-group">
	                                    <input type="text" class="form-control" placeholder="搜索定时任务..." id="scheduledSearch">
	                                    <button class="btn btn-outline-secondary" type="button" onclick="searchScheduledTasks()">
	                                        <i class="bi bi-search"></i>
	                                    </button>
	                                </div>
	                            </div>
	                            <div class="table-responsive">
	                                <table class="table table-hover">
	                                    <thead>
	                                        <tr>
	                                            <th>ID</th>
	                                            <th>任务名称</th>
	                                            <th>消息内容</th>
	                                            <th>发送间隔</th>
	                                            <th>状态</th>
	                                            <th>下次发送</th>
	                                            <th>操作</th>
	                                        </tr>
	                                    </thead>
	                                    <tbody id="scheduledTasksTable">
	                                        <tr>
	                                            <td colspan="7" class="text-center">加载中...</td>
	                                        </tr>
	                                    </tbody>
	                                </table>
	                            </div>
	                            <nav aria-label="Page navigation">
	                                <ul class="pagination justify-content-center" id="scheduledTasksPagination">
	                                    <!-- 分页按钮将通过JS动态生成 -->
	                                </ul>
	                            </nav>
	                        </div>
	                    </div>
	                </div>
	                <!-- 系统设置 -->
	                <div id="settingsSection" class="content-section" style="display: none;">
	                    <h2 class="mb-4">系统设置</h2>
	                    <div class="row">
	                        <div class="col-md-6 mb-4">
	                            <div class="card">
	                                <div class="card-header">
	                                    <h5>机器人状态</h5>
	                                </div>
	                                <div class="card-body">
	                                    <div class="form-check form-switch mb-3">
	                                        <input class="form-check-input" type="checkbox" id="botStatusSwitch" checked>
	                                        <label class="form-check-label" for="botStatusSwitch">
	                                            机器人运行状态
	                                        </label>
	                                    </div>
	                                    <p class="text-muted">当前状态: <span id="currentBotStatus">运行中</span></p>
	                                    <button class="btn btn-primary" onclick="toggleBotStatus()">
	                                        <i class="bi bi-power me-1"></i> 切换状态
	                                    </button>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="col-md-6 mb-4">
	                            <div class="card">
	                                <div class="card-header">
	                                    <h5>数据库状态</h5>
	                                </div>
	                                <div class="card-body">
	                                    <p>连接状态: <span class="badge bg-success" id="dbStatus">已连接</span></p>
	                                    <p>最后检查: <span id="dbLastCheck">未检查</span></p>
	                                    <button class="btn btn-primary" onclick="checkDbStatus()">
	                                        <i class="bi bi-arrow-clockwise me-1"></i> 检查连接
	                                    </button>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                    <div class="row">
	                        <div class="col-md-12 mb-4">
	                            <div class="card">
	                                <div class="card-header">
	                                    <h5>系统信息</h5>
	                                </div>
	                                <div class="card-body">
	                                    <div class="table-responsive">
	                                        <table class="table">
	                                            <tbody>
	                                                <tr>
	                                                    <th scope="row">版本</th>
	                                                    <td>1.0.0</td>
	                                                </tr>
	                                                <tr>
	                                                    <th scope="row">最后更新</th>
	                                                    <td id="lastUpdate">2023-01-01</td>
	                                                </tr>
	                                                <tr>
	                                                    <th scope="row">服务器时间</th>
	                                                    <td id="serverTime">-</td>
	                                                </tr>
	                                            </tbody>
	                                        </table>
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 用户编辑模态框 -->
	    <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
	        <div class="modal-dialog">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="editUserModalLabel">编辑用户</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="editUserForm">
	                        <input type="hidden" id="editUserId">
	                        <div class="mb-3">
	                            <label for="editUserName" class="form-label">用户名</label>
	                            <input type="text" class="form-control" id="editUserName" readonly>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editUserDisplayName" class="form-label">显示名称</label>
	                            <input type="text" class="form-control" id="editUserDisplayName">
	                        </div>
	                        <div class="mb-3">
	                            <label for="editUserPoints" class="form-label">积分</label>
	                            <input type="number" class="form-control" id="editUserPoints">
	                        </div>
	                        <div class="mb-3">
	                            <label for="editUserMessageCount" class="form-label">消息数</label>
	                            <input type="number" class="form-control" id="editUserMessageCount" readonly>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editUserLastSign" class="form-label">最后签到</label>
	                            <input type="text" class="form-control" id="editUserLastSign" readonly>
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="saveUser()">保存</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 老师编辑模态框 -->
	    <div class="modal fade" id="editTeacherModal" tabindex="-1" aria-labelledby="editTeacherModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-lg">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="editTeacherModalLabel">编辑老师</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="editTeacherForm">
	                        <input type="hidden" id="editTeacherId">
	                        <div class="row">
	                            <div class="col-md-6 mb-3">
	                                <label for="editTeacherNickname" class="form-label">花名</label>
	                                <input type="text" class="form-control" id="editTeacherNickname">
	                            </div>
	                            <div class="col-md-6 mb-3">
	                                <label for="editTeacherAge" class="form-label">年龄</label>
	                                <input type="number" class="form-control" id="editTeacherAge">
	                            </div>
	                        </div>
	                        <div class="row">
	                            <div class="col-md-6 mb-3">
	                                <label for="editTeacherRegion" class="form-label">地区</label>
	                                <input type="text" class="form-control" id="editTeacherRegion">
	                            </div>
	                            <div class="col-md-6 mb-3">
	                                <label for="editTeacherAccount" class="form-label">Telegram账号</label>
	                                <input type="text" class="form-control" id="editTeacherAccount">
	                            </div>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editTeacherChannel" class="form-label">频道链接</label>
	                            <input type="text" class="form-control" id="editTeacherChannel">
	                        </div>
	                        <div class="mb-3">
	                            <label for="editTeacherServiceType" class="form-label">服务类型</label>
	                            <input type="text" class="form-control" id="editTeacherServiceType">
	                        </div>
	                        <div class="mb-3">
	                            <label for="editTeacherRepairCost" class="form-label">修车费</label>
	                            <input type="text" class="form-control" id="editTeacherRepairCost">
	                        </div>
	                        <div class="mb-3">
	                            <label for="editTeacherIntro" class="form-label">自我介绍</label>
	                            <textarea class="form-control" id="editTeacherIntro" rows="3"></textarea>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editTeacherStatus" class="form-label">状态</label>
	                            <select class="form-select" id="editTeacherStatus">
	                                <option value="pending">待审核</option>
	                                <option value="approved">已通过</option>
	                                <option value="rejected">已拒绝</option>
	                            </select>
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="saveTeacher()">保存</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 关键词编辑模态框 -->
	    <div class="modal fade" id="editKeywordModal" tabindex="-1" aria-labelledby="editKeywordModalLabel" aria-hidden="true">
	        <div class="modal-dialog">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="editKeywordModalLabel">编辑关键词</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="editKeywordForm">
	                        <input type="hidden" id="editKeywordId">
	                        <div class="mb-3">
	                            <label for="editKeywordKeyword" class="form-label">关键词</label>
	                            <input type="text" class="form-control" id="editKeywordKeyword">
	                        </div>
	                        <div class="mb-3">
	                            <label for="editKeywordResponse" class="form-label">回复内容</label>
	                            <input type="text" class="form-control" id="editKeywordResponse">
	                        </div>
	                        <div class="mb-3">
	                            <label for="editKeywordReplyContent" class="form-label">自定义回复</label>
	                            <textarea class="form-control" id="editKeywordReplyContent" rows="3"></textarea>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editKeywordActive" class="form-label">状态</label>
	                            <select class="form-select" id="editKeywordActive">
	                                <option value="true">启用</option>
	                                <option value="false">禁用</option>
	                            </select>
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="saveKeyword()">保存</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 禁言词编辑模态框 -->
	    <div class="modal fade" id="editBannedModal" tabindex="-1" aria-labelledby="editBannedModalLabel" aria-hidden="true">
	        <div class="modal-dialog">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="editBannedModalLabel">编辑禁言词</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="editBannedForm">
	                        <input type="hidden" id="editBannedId">
	                        <div class="mb-3">
	                            <label for="editBannedKeyword" class="form-label">禁言词</label>
	                            <input type="text" class="form-control" id="editBannedKeyword">
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="saveBanned()">保存</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 定时任务编辑模态框 -->
	    <div class="modal fade" id="editScheduledTaskModal" tabindex="-1" aria-labelledby="editScheduledTaskModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-lg">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="editScheduledTaskModalLabel">编辑定时任务</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="editScheduledTaskForm">
	                        <input type="hidden" id="editScheduledTaskId">
	                        <div class="mb-3">
	                            <label for="editScheduledTaskName" class="form-label">任务名称</label>
	                            <input type="text" class="form-control" id="editScheduledTaskName" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editScheduledTaskContent" class="form-label">消息内容</label>
	                            <textarea class="form-control" id="editScheduledTaskContent" rows="4" required></textarea>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editScheduledTaskChatIds" class="form-label">目标群/频道ID (用逗号分隔)</label>
	                            <input type="text" class="form-control" id="editScheduledTaskChatIds" required>
	                            <div class="form-text">例如: -100123456789,-100987654321</div>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editScheduledTaskInterval" class="form-label">发送间隔 (分钟)</label>
	                            <input type="number" class="form-control" id="editScheduledTaskInterval" min="1" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editScheduledTaskNextSend" class="form-label">下次发送时间</label>
	                            <input type="datetime-local" class="form-control" id="editScheduledTaskNextSend">
	                            <div class="form-text">留空则使用当前时间</div>
	                        </div>
	                        <div class="mb-3">
	                            <label for="editScheduledTaskActive" class="form-label">状态</label>
	                            <select class="form-select" id="editScheduledTaskActive">
	                                <option value="true">激活</option>
	                                <option value="false">未激活</option>
	                            </select>
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="saveScheduledTask()">保存</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 添加用户模态框 -->
	    <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
	        <div class="modal-dialog">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="addUserModalLabel">添加用户</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="addUserForm">
	                        <div class="mb-3">
	                            <label for="addUserId" class="form-label">用户ID</label>
	                            <input type="number" class="form-control" id="addUserId" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addUserName" class="form-label">用户名</label>
	                            <input type="text" class="form-control" id="addUserName" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addUserDisplayName" class="form-label">显示名称</label>
	                            <input type="text" class="form-control" id="addUserDisplayName">
	                        </div>
	                        <div class="mb-3">
	                            <label for="addUserPoints" class="form-label">积分</label>
	                            <input type="number" class="form-control" id="addUserPoints" value="0">
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="addUser()">添加</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 添加老师模态框 -->
	    <div class="modal fade" id="addTeacherModal" tabindex="-1" aria-labelledby="addTeacherModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-lg">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="addTeacherModalLabel">添加老师</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="addTeacherForm">
	                        <div class="row">
	                            <div class="col-md-6 mb-3">
	                                <label for="addTeacherNickname" class="form-label">花名</label>
	                                <input type="text" class="form-control" id="addTeacherNickname" required>
	                            </div>
	                            <div class="col-md-6 mb-3">
	                                <label for="addTeacherAge" class="form-label">年龄</label>
	                                <input type="number" class="form-control" id="addTeacherAge" required>
	                            </div>
	                        </div>
	                        <div class="row">
	                            <div class="col-md-6 mb-3">
	                                <label for="addTeacherRegion" class="form-label">地区</label>
	                                <input type="text" class="form-control" id="addTeacherRegion" required>
	                            </div>
	                            <div class="col-md-6 mb-3">
	                                <label for="addTeacherAccount" class="form-label">Telegram账号</label>
	                                <input type="text" class="form-control" id="addTeacherAccount" required>
	                            </div>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addTeacherChannel" class="form-label">频道链接</label>
	                            <input type="text" class="form-control" id="addTeacherChannel" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addTeacherServiceType" class="form-label">服务类型</label>
	                            <input type="text" class="form-control" id="addTeacherServiceType" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addTeacherRepairCost" class="form-label">修车费</label>
	                            <input type="text" class="form-control" id="addTeacherRepairCost" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addTeacherIntro" class="form-label">自我介绍</label>
	                            <textarea class="form-control" id="addTeacherIntro" rows="3" required></textarea>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addTeacherStatus" class="form-label">状态</label>
	                            <select class="form-select" id="addTeacherStatus">
	                                <option value="pending">待审核</option>
	                                <option value="approved">已通过</option>
	                                <option value="rejected">已拒绝</option>
	                            </select>
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="addTeacher()">添加</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 添加关键词模态框 -->
	    <div class="modal fade" id="addKeywordModal" tabindex="-1" aria-labelledby="addKeywordModalLabel" aria-hidden="true">
	        <div class="modal-dialog">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="addKeywordModalLabel">添加关键词</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="addKeywordForm">
	                        <div class="mb-3">
	                            <label for="addKeywordKeyword" class="form-label">关键词</label>
	                            <input type="text" class="form-control" id="addKeywordKeyword" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addKeywordResponse" class="form-label">回复内容</label>
	                            <input type="text" class="form-control" id="addKeywordResponse" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addKeywordReplyContent" class="form-label">自定义回复</label>
	                            <textarea class="form-control" id="addKeywordReplyContent" rows="3"></textarea>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addKeywordActive" class="form-label">状态</label>
	                            <select class="form-select" id="addKeywordActive">
	                                <option value="true" selected>启用</option>
	                                <option value="false">禁用</option>
	                            </select>
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="addKeyword()">添加</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 添加禁言词模态框 -->
	    <div class="modal fade" id="addBannedModal" tabindex="-1" aria-labelledby="addBannedModalLabel" aria-hidden="true">
	        <div class="modal-dialog">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="addBannedModalLabel">添加禁言词</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="addBannedForm">
	                        <div class="mb-3">
	                            <label for="addBannedKeyword" class="form-label">禁言词</label>
	                            <input type="text" class="form-control" id="addBannedKeyword" required>
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="addBanned()">添加</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 添加定时任务模态框 -->
	    <div class="modal fade" id="addScheduledTaskModal" tabindex="-1" aria-labelledby="addScheduledTaskModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-lg">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="addScheduledTaskModalLabel">添加定时任务</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="addScheduledTaskForm">
	                        <div class="mb-3">
	                            <label for="addScheduledTaskName" class="form-label">任务名称</label>
	                            <input type="text" class="form-control" id="addScheduledTaskName" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addScheduledTaskContent" class="form-label">消息内容</label>
	                            <textarea class="form-control" id="addScheduledTaskContent" rows="4" required></textarea>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addScheduledTaskChatIds" class="form-label">目标群/频道ID (用逗号分隔)</label>
	                            <input type="text" class="form-control" id="addScheduledTaskChatIds" required>
	                            <div class="form-text">例如: -100123456789,-100987654321</div>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addScheduledTaskInterval" class="form-label">发送间隔 (分钟)</label>
	                            <input type="number" class="form-control" id="addScheduledTaskInterval" min="1" value="60" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addScheduledTaskNextSend" class="form-label">下次发送时间</label>
	                            <input type="datetime-local" class="form-control" id="addScheduledTaskNextSend">
	                            <div class="form-text">留空则使用当前时间</div>
	                        </div>
	                        <div class="mb-3">
	                            <label for="addScheduledTaskActive" class="form-label">状态</label>
	                            <select class="form-select" id="addScheduledTaskActive">
	                                <option value="true" selected>激活</option>
	                                <option value="false">未激活</option>
	                            </select>
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="addScheduledTask()">添加</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 调整积分模态框 -->
	    <div class="modal fade" id="adjustPointsModal" tabindex="-1" aria-labelledby="adjustPointsModalLabel" aria-hidden="true">
	        <div class="modal-dialog">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="adjustPointsModalLabel">调整积分</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form id="adjustPointsForm">
	                        <input type="hidden" id="adjustPointsUserId">
	                        <div class="mb-3">
	                            <label for="adjustPointsUserName" class="form-label">用户</label>
	                            <input type="text" class="form-control" id="adjustPointsUserName" readonly>
	                        </div>
	                        <div class="mb-3">
	                            <label for="adjustPointsCurrent" class="form-label">当前积分</label>
	                            <input type="number" class="form-control" id="adjustPointsCurrent" readonly>
	                        </div>
	                        <div class="mb-3">
	                            <label for="adjustPointsChange" class="form-label">积分变化</label>
	                            <input type="number" class="form-control" id="adjustPointsChange" placeholder="正数为增加，负数为减少">
	                        </div>
	                        <div class="mb-3">
	                            <label for="adjustPointsReason" class="form-label">原因</label>
	                            <input type="text" class="form-control" id="adjustPointsReason" placeholder="调整原因">
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
	                    <button type="button" class="btn btn-primary" onclick="adjustPoints()">调整</button>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- 提示框容器 -->
	    <div class="alert-container" id="alertContainer"></div>
	    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	    <script>
	        // 配置信息
	        const API_BASE_URL = 'https://telegram-bot.jbk123jbk.workers.dev';
	        const SUPABASE_URL = 'https://tekuxjnnwtqmygibvwux.supabase.co';
	        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRla3V4am5ud3RxbXlnaWJ2d3V4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzNDUzNjAsImV4cCI6MjA3MDkyMTM2MH0.RGmuF44husXoJP8y4U1Gx7HqQJ6MsYZVl6_vHtG-KJY';
	        const SUPABASE_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRla3V4am5ud3RxbXlnaWJ2d3V4Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NTM0NTM2MCwiZXhwIjoyMDcwOTIxMzYwfQ.e-qivjGp1ZVf6baQh_xLOrVOkBqeZ4m5DinHXhI2Sqw';
	        const ADMIN_API_KEY = '9712202273aA.';
	        // 全局变量
	        let adminApiKey = '';
	        let currentSection = 'dashboard';
	        let usersData = [];
	        let teachersData = [];
	        let keywordsData = [];
	        let bannedData = [];
	        let scheduledTasksData = [];
	        let currentPage = {
	            users: 1,
	            teachers: 1,
	            keywords: 1,
	            banned: 1,
	            scheduled: 1
	        };
	        const itemsPerPage = 10;
	        // 初始化
	        document.addEventListener('DOMContentLoaded', function() {
	            // 检查是否已登录
	            const savedApiKey = localStorage.getItem('adminApiKey');
	            if (savedApiKey) {
	                adminApiKey = savedApiKey;
	                showMainInterface();
	                loadDashboard();
	            }
	        });
	        // 登录
	        function login() {
	            const key = document.getElementById('adminKey').value;
	            if (!key) {
	                showAlert('请输入管理员密钥', 'danger');
	                return;
	            }
	            showLoading(true);
	            // 使用直接验证方式，而不是通过API
	            if (key === ADMIN_API_KEY) {
	                adminApiKey = key;
	                localStorage.setItem('adminApiKey', key);
	                showMainInterface();
	                loadDashboard();
	                showAlert('登录成功', 'success');
	            } else {
	                showAlert('管理员密钥错误', 'danger');
	            }
	            showLoading(false);
	        }
	        // 退出登录
	        function logout() {
	            localStorage.removeItem('adminApiKey');
	            adminApiKey = '';
	            document.getElementById('loginContainer').style.display = 'block';
	            document.getElementById('mainContainer').style.display = 'none';
	            document.getElementById('adminKey').value = '';
	        }
	        // 显示主界面
	        function showMainInterface() {
	            document.getElementById('loginContainer').style.display = 'none';
	            document.getElementById('mainContainer').style.display = 'block';
	        }
	        // 显示部分
	        function showSection(section) {
	            // 隐藏所有部分
	            document.querySelectorAll('.content-section').forEach(el => {
	                el.style.display = 'none';
	            });
	            // 显示选中的部分
	            document.getElementById(section + 'Section').style.display = 'block';
	            // 更新侧边栏激活状态
	            document.querySelectorAll('.sidebar .nav-link').forEach(el => {
	                el.classList.remove('active');
	            });
	            event.target.classList.add('active');
	            currentSection = section;
	            // 加载数据
	            switch(section) {
	                case 'dashboard':
	                    loadDashboard();
	                    break;
	                case 'users':
	                    loadUsers();
	                    break;
	                case 'teachers':
	                    loadTeachers();
	                    break;
	                case 'keywords':
	                    loadKeywords();
	                    break;
	                case 'banned':
	                    loadBanned();
	                    break;
	                case 'scheduled':
	                    loadScheduledTasks();
	                    break;
	                case 'settings':
	                    loadSettings();
	                    break;
	            }
	        }
	        // 加载仪表盘
	        function loadDashboard() {
	            showLoading(true);
	            // 获取统计数据
	            Promise.all([
	                directSupabaseFetch('users'),
	                directSupabaseFetch('teachers'),
	                directSupabaseFetch('keywords'),
	                directSupabaseFetchWithServiceKey('banned_keywords') // 使用服务角色密钥获取禁言词
	            ])
	            .then(([users, teachers, keywords, banned]) => {
	                document.getElementById('totalUsers').textContent = users.length;
	                document.getElementById('totalTeachers').textContent = teachers.length;
	                document.getElementById('totalKeywords').textContent = keywords.length;
	                document.getElementById('totalBanned').textContent = banned.length;
	                // 加载最近用户
	                const recentUsers = users.slice(0, 5);
	                const recentUsersHtml = recentUsers.map(user => `
	                    <tr>
	                        <td>${user.user_id}</td>
	                        <td>${user.username || '-'}</td>
	                        <td>${user.points || 0}</td>
	                        <td>${user.last_sign_date ? new Date(user.last_sign_date).toLocaleDateString() : '-'}</td>
	                    </tr>
	                `).join('');
	                document.getElementById('recentUsers').innerHTML = recentUsersHtml;
	                // 加载最近老师
	                const recentTeachers = teachers.slice(0, 5);
	                const recentTeachersHtml = recentTeachers.map(teacher => `
	                    <tr>
	                        <td>${teacher.nickname}</td>
	                        <td>${teacher.age}</td>
	                        <td>${teacher.region}</td>
	                        <td>${getStatusBadge(teacher.status)}</td>
	                    </tr>
	                `).join('');
	                document.getElementById('recentTeachers').innerHTML = recentTeachersHtml;
	            })
	            .catch(error => {
	                showAlert('加载仪表盘失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 加载用户数据
	        function loadUsers(page = 1) {
	            showLoading(true);
	            currentPage.users = page;
	            directSupabaseFetch('users')
	            .then(data => {
	                usersData = data;
	                renderUsersTable();
	            })
	            .catch(error => {
	                showAlert('加载用户数据失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 渲染用户表格
	        function renderUsersTable() {
	            const start = (currentPage.users - 1) * itemsPerPage;
	            const end = start + itemsPerPage;
	            const pageData = usersData.slice(start, end);
	            const html = pageData.map(user => `
	                <tr>
	                    <td>${user.user_id}</td>
	                    <td>${user.username || '-'}</td>
	                    <td>${user.display_name || '-'}</td>
	                    <td>${user.points || 0}</td>
	                    <td>${user.message_count_today || 0}</td>
	                    <td>${user.last_sign_date ? new Date(user.last_sign_date).toLocaleDateString() : '-'}</td>
	                    <td>
	                        <button class="btn btn-sm btn-primary btn-action" onclick="editUser(${user.user_id})">
	                            <i class="bi bi-pencil"></i>
	                        </button>
	                        <button class="btn btn-sm btn-warning btn-action" onclick="showAdjustPointsModal(${user.user_id})">
	                            <i class="bi bi-cash-coin"></i>
	                        </button>
	                        <button class="btn btn-sm btn-danger btn-action" onclick="deleteUser(${user.user_id})">
	                            <i class="bi bi-trash"></i>
	                        </button>
	                    </td>
	                </tr>
	            `).join('');
	            document.getElementById('usersTable').innerHTML = html || '<tr><td colspan="7" class="text-center">暂无数据</td></tr>';
	            // 渲染分页
	            renderPagination('users', usersData.length, currentPage.users);
	        }
	        // 搜索用户
	        function searchUsers() {
	            const keyword = document.getElementById('userSearch').value.toLowerCase();
	            if (!keyword) {
	                renderUsersTable();
	                return;
	            }
	            const filtered = usersData.filter(user => 
	                (user.username && user.username.toLowerCase().includes(keyword)) ||
	                (user.display_name && user.display_name.toLowerCase().includes(keyword)) ||
	                user.user_id.toString().includes(keyword)
	            );
	            usersData = filtered;
	            currentPage.users = 1;
	            renderUsersTable();
	        }
	        // 编辑用户
	        function editUser(userId) {
	            const user = usersData.find(u => u.user_id === userId);
	            if (!user) return;
	            document.getElementById('editUserId').value = user.user_id;
	            document.getElementById('editUserName').value = user.username || '';
	            document.getElementById('editUserDisplayName').value = user.display_name || '';
	            document.getElementById('editUserPoints').value = user.points || 0;
	            document.getElementById('editUserMessageCount').value = user.message_count_today || 0;
	            document.getElementById('editUserLastSign').value = user.last_sign_date ? new Date(user.last_sign_date).toLocaleDateString() : '';
	            const modal = new bootstrap.Modal(document.getElementById('editUserModal'));
	            modal.show();
	        }
	        // 保存用户
	        function saveUser() {
	            const userId = document.getElementById('editUserId').value;
	            const userData = {
	                user_id: parseInt(userId),
	                username: document.getElementById('editUserName').value,
	                display_name: document.getElementById('editUserDisplayName').value,
	                points: parseInt(document.getElementById('editUserPoints').value)
	            };
	            showLoading(true);
	            directSupabaseUpsert('users', userData, 'user_id')
	            .then(() => {
	                showAlert('用户保存成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('editUserModal')).hide();
	                loadUsers(currentPage.users);
	            })
	            .catch(error => {
	                showAlert('保存用户失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 删除用户
	        function deleteUser(userId) {
	            if (!confirm('确定要删除这个用户吗？')) return;
	            showLoading(true);
	            directSupabaseDelete('users', userId)
	            .then(() => {
	                showAlert('用户删除成功', 'success');
	                loadUsers(currentPage.users);
	            })
	            .catch(error => {
	                showAlert('删除用户失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 显示调整积分模态框
	        function showAdjustPointsModal(userId) {
	            const user = usersData.find(u => u.user_id === userId);
	            if (!user) return;
	            document.getElementById('adjustPointsUserId').value = user.user_id;
	            document.getElementById('adjustPointsUserName').value = user.display_name || user.username || '用户' + user.user_id;
	            document.getElementById('adjustPointsCurrent').value = user.points || 0;
	            document.getElementById('adjustPointsChange').value = '';
	            document.getElementById('adjustPointsReason').value = '';
	            const modal = new bootstrap.Modal(document.getElementById('adjustPointsModal'));
	            modal.show();
	        }
	        // 调整积分
	        function adjustPoints() {
	            const userId = document.getElementById('adjustPointsUserId').value;
	            const pointsChange = parseInt(document.getElementById('adjustPointsChange').value) || 0;
	            if (pointsChange === 0) {
	                showAlert('请输入有效的积分变化值', 'warning');
	                return;
	            }
	            showLoading(true);
	            directSupabaseFetch('users', `user_id=eq.${userId}`)
	            .then(user => {
	                if (!user) throw new Error("用户不存在");
	                const newPoints = Math.max(0, (user.points || 0) + pointsChange);
	                return directSupabaseUpsert('users', { ...user, points: newPoints }, 'user_id');
	            })
	            .then(() => {
	                showAlert('积分调整成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('adjustPointsModal')).hide();
	                loadUsers(currentPage.users);
	            })
	            .catch(error => {
	                showAlert('调整积分失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 显示添加用户模态框
	        function showAddUserModal() {
	            document.getElementById('addUserForm').reset();
	            const modal = new bootstrap.Modal(document.getElementById('addUserModal'));
	            modal.show();
	        }
	        // 添加用户
	        function addUser() {
	            const userData = {
	                user_id: parseInt(document.getElementById('addUserId').value),
	                username: document.getElementById('addUserName').value,
	                display_name: document.getElementById('addUserDisplayName').value,
	                points: parseInt(document.getElementById('addUserPoints').value) || 0
	            };
	            showLoading(true);
	            directSupabaseInsert('users', userData)
	            .then(() => {
	                showAlert('用户添加成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
	                loadUsers(currentPage.users);
	            })
	            .catch(error => {
	                showAlert('添加用户失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 加载老师数据
	        function loadTeachers(page = 1) {
	            showLoading(true);
	            currentPage.teachers = page;
	            directSupabaseFetch('teachers')
	            .then(data => {
	                teachersData = data;
	                renderTeachersTable();
	            })
	            .catch(error => {
	                showAlert('加载老师数据失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 渲染老师表格
	        function renderTeachersTable() {
	            const start = (currentPage.teachers - 1) * itemsPerPage;
	            const end = start + itemsPerPage;
	            const pageData = teachersData.slice(start, end);
	            const html = pageData.map(teacher => `
	                <tr>
	                    <td>${teacher.id}</td>
	                    <td>${teacher.nickname}</td>
	                    <td>${teacher.age}</td>
	                    <td>${teacher.region}</td>
	                    <td>${teacher.telegram_account}</td>
	                    <td>${teacher.service_type}</td>
	                    <td>${getStatusBadge(teacher.status)}</td>
	                    <td>
	                        <button class="btn btn-sm btn-primary btn-action" onclick="editTeacher(${teacher.id})">
	                            <i class="bi bi-pencil"></i>
	                        </button>
	                        <button class="btn btn-sm btn-danger btn-action" onclick="deleteTeacher(${teacher.id})">
	                            <i class="bi bi-trash"></i>
	                        </button>
	                    </td>
	                </tr>
	            `).join('');
	            document.getElementById('teachersTable').innerHTML = html || '<tr><td colspan="8" class="text-center">暂无数据</td></tr>';
	            // 渲染分页
	            renderPagination('teachers', teachersData.length, currentPage.teachers);
	        }
	        // 搜索老师
	        function searchTeachers() {
	            const keyword = document.getElementById('teacherSearch').value.toLowerCase();
	            if (!keyword) {
	                renderTeachersTable();
	                return;
	            }
	            const filtered = teachersData.filter(teacher => 
	                teacher.nickname.toLowerCase().includes(keyword) ||
	                teacher.region.toLowerCase().includes(keyword) ||
	                teacher.telegram_account.toLowerCase().includes(keyword)
	            );
	            teachersData = filtered;
	            currentPage.teachers = 1;
	            renderTeachersTable();
	        }
	        // 编辑老师
	        function editTeacher(teacherId) {
	            const teacher = teachersData.find(t => t.id === teacherId);
	            if (!teacher) return;
	            document.getElementById('editTeacherId').value = teacher.id;
	            document.getElementById('editTeacherNickname').value = teacher.nickname;
	            document.getElementById('editTeacherAge').value = teacher.age;
	            document.getElementById('editTeacherRegion').value = teacher.region;
	            document.getElementById('editTeacherAccount').value = teacher.telegram_account;
	            document.getElementById('editTeacherChannel').value = teacher.channel;
	            document.getElementById('editTeacherServiceType').value = teacher.service_type;
	            document.getElementById('editTeacherRepairCost').value = teacher.repair_cost;
	            document.getElementById('editTeacherIntro').value = teacher.intro;
	            document.getElementById('editTeacherStatus').value = teacher.status;
	            const modal = new bootstrap.Modal(document.getElementById('editTeacherModal'));
	            modal.show();
	        }
	        // 保存老师
	        function saveTeacher() {
	            const teacherId = document.getElementById('editTeacherId').value;
	            const teacherData = {
	                id: parseInt(teacherId),
	                nickname: document.getElementById('editTeacherNickname').value,
	                age: parseInt(document.getElementById('editTeacherAge').value),
	                region: document.getElementById('editTeacherRegion').value,
	                telegram_account: document.getElementById('editTeacherAccount').value,
	                channel: document.getElementById('editTeacherChannel').value,
	                service_type: document.getElementById('editTeacherServiceType').value,
	                repair_cost: document.getElementById('editTeacherRepairCost').value,
	                intro: document.getElementById('editTeacherIntro').value,
	                status: document.getElementById('editTeacherStatus').value
	            };
	            showLoading(true);
	            directSupabaseUpsert('teachers', teacherData, 'id')
	            .then(() => {
	                showAlert('老师保存成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('editTeacherModal')).hide();
	                loadTeachers(currentPage.teachers);
	            })
	            .catch(error => {
	                showAlert('保存老师失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 删除老师
	        function deleteTeacher(teacherId) {
	            if (!confirm('确定要删除这个老师吗？')) return;
	            showLoading(true);
	            directSupabaseDelete('teachers', teacherId)
	            .then(() => {
	                showAlert('老师删除成功', 'success');
	                loadTeachers(currentPage.teachers);
	            })
	            .catch(error => {
	                showAlert('删除老师失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 显示添加老师模态框
	        function showAddTeacherModal() {
	            document.getElementById('addTeacherForm').reset();
	            const modal = new bootstrap.Modal(document.getElementById('addTeacherModal'));
	            modal.show();
	        }
	        // 添加老师
	        function addTeacher() {
	            const teacherData = {
	                nickname: document.getElementById('addTeacherNickname').value,
	                age: parseInt(document.getElementById('addTeacherAge').value),
	                region: document.getElementById('addTeacherRegion').value,
	                telegram_account: document.getElementById('addTeacherAccount').value,
	                channel: document.getElementById('addTeacherChannel').value,
	                service_type: document.getElementById('addTeacherServiceType').value,
	                repair_cost: document.getElementById('addTeacherRepairCost').value,
	                intro: document.getElementById('addTeacherIntro').value,
	                status: document.getElementById('addTeacherStatus').value
	            };
	            showLoading(true);
	            directSupabaseInsert('teachers', teacherData)
	            .then(() => {
	                showAlert('老师添加成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('addTeacherModal')).hide();
	                loadTeachers(currentPage.teachers);
	            })
	            .catch(error => {
	                showAlert('添加老师失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 加载关键词数据
	        function loadKeywords(page = 1) {
	            showLoading(true);
	            currentPage.keywords = page;
	            directSupabaseFetch('keywords')
	            .then(data => {
	                keywordsData = data;
	                renderKeywordsTable();
	            })
	            .catch(error => {
	                showAlert('加载关键词数据失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 渲染关键词表格
	        function renderKeywordsTable() {
	            const start = (currentPage.keywords - 1) * itemsPerPage;
	            const end = start + itemsPerPage;
	            const pageData = keywordsData.slice(start, end);
	            const html = pageData.map(keyword => `
	                <tr>
	                    <td>${keyword.id}</td>
	                    <td>${keyword.keyword}</td>
	                    <td>${keyword.response}</td>
	                    <td>${keyword.reply_content || '-'}</td>
	                    <td>${keyword.is_active ? '<span class="badge bg-success">启用</span>' : '<span class="badge bg-secondary">禁用</span>'}</td>
	                    <td>
	                        <button class="btn btn-sm btn-primary btn-action" onclick="editKeyword(${keyword.id})">
	                            <i class="bi bi-pencil"></i>
	                        </button>
	                        <button class="btn btn-sm btn-danger btn-action" onclick="deleteKeyword(${keyword.id})">
	                            <i class="bi bi-trash"></i>
	                        </button>
	                    </td>
	                </tr>
	            `).join('');
	            document.getElementById('keywordsTable').innerHTML = html || '<tr><td colspan="6" class="text-center">暂无数据</td></tr>';
	            // 渲染分页
	            renderPagination('keywords', keywordsData.length, currentPage.keywords);
	        }
	        // 搜索关键词
	        function searchKeywords() {
	            const keyword = document.getElementById('keywordSearch').value.toLowerCase();
	            if (!keyword) {
	                renderKeywordsTable();
	                return;
	            }
	            const filtered = keywordsData.filter(k => 
	                k.keyword.toLowerCase().includes(keyword) ||
	                k.response.toLowerCase().includes(keyword) ||
	                (k.reply_content && k.reply_content.toLowerCase().includes(keyword))
	            );
	            keywordsData = filtered;
	            currentPage.keywords = 1;
	            renderKeywordsTable();
	        }
	        // 编辑关键词
	        function editKeyword(keywordId) {
	            const keyword = keywordsData.find(k => k.id === keywordId);
	            if (!keyword) return;
	            document.getElementById('editKeywordId').value = keyword.id;
	            document.getElementById('editKeywordKeyword').value = keyword.keyword;
	            document.getElementById('editKeywordResponse').value = keyword.response;
	            document.getElementById('editKeywordReplyContent').value = keyword.reply_content || '';
	            document.getElementById('editKeywordActive').value = keyword.is_active ? 'true' : 'false';
	            const modal = new bootstrap.Modal(document.getElementById('editKeywordModal'));
	            modal.show();
	        }
	        // 保存关键词
	        function saveKeyword() {
	            const keywordId = document.getElementById('editKeywordId').value;
	            const keywordData = {
	                id: parseInt(keywordId),
	                keyword: document.getElementById('editKeywordKeyword').value,
	                response: document.getElementById('editKeywordResponse').value,
	                reply_content: document.getElementById('editKeywordReplyContent').value,
	                is_active: document.getElementById('editKeywordActive').value === 'true'
	            };
	            showLoading(true);
	            directSupabaseUpsert('keywords', keywordData, 'id')
	            .then(() => {
	                showAlert('关键词保存成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('editKeywordModal')).hide();
	                loadKeywords(currentPage.keywords);
	            })
	            .catch(error => {
	                showAlert('保存关键词失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 删除关键词
	        function deleteKeyword(keywordId) {
	            if (!confirm('确定要删除这个关键词吗？')) return;
	            showLoading(true);
	            directSupabaseDelete('keywords', keywordId)
	            .then(() => {
	                showAlert('关键词删除成功', 'success');
	                loadKeywords(currentPage.keywords);
	            })
	            .catch(error => {
	                showAlert('删除关键词失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 显示添加关键词模态框
	        function showAddKeywordModal() {
	            document.getElementById('addKeywordForm').reset();
	            const modal = new bootstrap.Modal(document.getElementById('addKeywordModal'));
	            modal.show();
	        }
	        // 添加关键词
	        function addKeyword() {
	            const keywordData = {
	                keyword: document.getElementById('addKeywordKeyword').value,
	                response: document.getElementById('addKeywordResponse').value,
	                reply_content: document.getElementById('addKeywordReplyContent').value,
	                is_active: document.getElementById('addKeywordActive').value === 'true'
	            };
	            showLoading(true);
	            directSupabaseInsertWithServiceKey('keywords', keywordData)
	            .then(() => {
	                showAlert('关键词添加成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('addKeywordModal')).hide();
	                loadKeywords(currentPage.keywords);
	            })
	            .catch(error => {
	                showAlert('添加关键词失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 加载禁言词数据
	        function loadBanned(page = 1) {
	            showLoading(true);
	            currentPage.banned = page;
	            // 使用服务角色密钥获取禁言词数据
	            directSupabaseFetchWithServiceKey('banned_keywords')
	            .then(data => {
	                bannedData = data;
	                renderBannedTable();
	            })
	            .catch(error => {
	                showAlert('加载禁言词数据失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 渲染禁言词表格
	        function renderBannedTable() {
	            const start = (currentPage.banned - 1) * itemsPerPage;
	            const end = start + itemsPerPage;
	            const pageData = bannedData.slice(start, end);
	            const html = pageData.map(banned => `
	                <tr>
	                    <td>${banned.id}</td>
	                    <td>${banned.keyword}</td>
	                    <td>
	                        <button class="btn btn-sm btn-primary btn-action" onclick="editBanned(${banned.id})">
	                            <i class="bi bi-pencil"></i>
	                        </button>
	                        <button class="btn btn-sm btn-danger btn-action" onclick="deleteBanned(${banned.id})">
	                            <i class="bi bi-trash"></i>
	                        </button>
	                    </td>
	                </tr>
	            `).join('');
	            document.getElementById('bannedTable').innerHTML = html || '<tr><td colspan="3" class="text-center">暂无数据</td></tr>';
	            // 渲染分页
	            renderPagination('banned', bannedData.length, currentPage.banned);
	        }
	        // 搜索禁言词
	        function searchBanned() {
	            const keyword = document.getElementById('bannedSearch').value.toLowerCase();
	            if (!keyword) {
	                renderBannedTable();
	                return;
	            }
	            const filtered = bannedData.filter(b => 
	                b.keyword.toLowerCase().includes(keyword)
	            );
	            bannedData = filtered;
	            currentPage.banned = 1;
	            renderBannedTable();
	        }
	        // 编辑禁言词
	        function editBanned(bannedId) {
	            const banned = bannedData.find(b => b.id === bannedId);
	            if (!banned) return;
	            document.getElementById('editBannedId').value = banned.id;
	            document.getElementById('editBannedKeyword').value = banned.keyword;
	            const modal = new bootstrap.Modal(document.getElementById('editBannedModal'));
	            modal.show();
	        }
	        // 保存禁言词
	        function saveBanned() {
	            const bannedId = document.getElementById('editBannedId').value;
	            const bannedData = {
	                id: parseInt(bannedId),
	                keyword: document.getElementById('editBannedKeyword').value
	            };
	            showLoading(true);
	            directSupabaseUpsertWithServiceKey('banned_keywords', bannedData, 'id')
	            .then(() => {
	                showAlert('禁言词保存成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('editBannedModal')).hide();
	                loadBanned(currentPage.banned);
	            })
	            .catch(error => {
	                showAlert('保存禁言词失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 删除禁言词
	        function deleteBanned(bannedId) {
	            if (!confirm('确定要删除这个禁言词吗？')) return;
	            showLoading(true);
	            directSupabaseDeleteWithServiceKey('banned_keywords', bannedId)
	            .then(() => {
	                showAlert('禁言词删除成功', 'success');
	                loadBanned(currentPage.banned);
	            })
	            .catch(error => {
	                showAlert('删除禁言词失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 显示添加禁言词模态框
	        function showAddBannedModal() {
	            document.getElementById('addBannedForm').reset();
	            const modal = new bootstrap.Modal(document.getElementById('addBannedModal'));
	            modal.show();
	        }
	        // 添加禁言词
	        function addBanned() {
	            const bannedData = {
	                keyword: document.getElementById('addBannedKeyword').value
	            };
	            showLoading(true);
	            directSupabaseInsertWithServiceKey('banned_keywords', bannedData)
	            .then(() => {
	                showAlert('禁言词添加成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('addBannedModal')).hide();
	                loadBanned(currentPage.banned);
	            })
	            .catch(error => {
	                showAlert('添加禁言词失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 定时发送任务相关函数
	        // 加载定时任务数据
	        function loadScheduledTasks(page = 1) {
	            showLoading(true);
	            currentPage.scheduled = page;
	            // 使用服务角色密钥获取定时任务数据
	            directSupabaseFetchWithServiceKey('scheduled_messages')
	            .then(data => {
	                scheduledTasksData = data;
	                renderScheduledTasksTable();
	            })
	            .catch(error => {
	                showAlert('加载定时任务失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 渲染定时任务表格
	        function renderScheduledTasksTable() {
	            const start = (currentPage.scheduled - 1) * itemsPerPage;
	            const end = start + itemsPerPage;
	            const pageData = scheduledTasksData.slice(start, end);
	            const html = pageData.map(task => `
	                <tr>
	                    <td>${task.id}</td>
	                    <td>${task.name}</td>
	                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${task.content}">${task.content}</td>
	                    <td>${task.interval} 分钟</td>
	                    <td>${task.is_active ? '<span class="status-active">激活</span>' : '<span class="status-inactive">未激活</span>'}</td>
	                    <td>${new Date(task.next_send_time).toLocaleString()}</td>
	                    <td>
	                        <button class="btn btn-sm btn-primary btn-action" onclick="triggerScheduledTask(${task.id})" title="立即触发">
	                            <i class="bi bi-play-circle"></i>
	                        </button>
	                        <button class="btn btn-sm btn-warning btn-action" onclick="editScheduledTask(${task.id})" title="编辑">
	                            <i class="bi bi-pencil"></i>
	                        </button>
	                        <button class="btn btn-sm btn-danger btn-action" onclick="deleteScheduledTask(${task.id})" title="删除">
	                            <i class="bi bi-trash"></i>
	                        </button>
	                    </td>
	                </tr>
	            `).join('');
	            document.getElementById('scheduledTasksTable').innerHTML = html || '<tr><td colspan="7" class="text-center">暂无数据</td></tr>';
	            // 渲染分页
	            renderPagination('scheduled', scheduledTasksData.length, currentPage.scheduled);
	        }
	        // 搜索定时任务
	        function searchScheduledTasks() {
	            const keyword = document.getElementById('scheduledSearch').value.toLowerCase();
	            if (!keyword) {
	                renderScheduledTasksTable();
	                return;
	            }
	            const filtered = scheduledTasksData.filter(task => 
	                task.name.toLowerCase().includes(keyword) ||
	                task.content.toLowerCase().includes(keyword)
	            );
	            scheduledTasksData = filtered;
	            currentPage.scheduled = 1;
	            renderScheduledTasksTable();
	        }
	        // 刷新定时任务列表
	        function refreshScheduledTasks() {
	            loadScheduledTasks(currentPage.scheduled);
	        }
	        // 显示添加定时任务模态框
	        function showAddScheduledTaskModal() {
	            document.getElementById('addScheduledTaskForm').reset();
	            // 设置默认下次发送时间为当前时间
	            const now = new Date();
	            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
	            document.getElementById('addScheduledTaskNextSend').value = now.toISOString().slice(0, 16);
	            const modal = new bootstrap.Modal(document.getElementById('addScheduledTaskModal'));
	            modal.show();
	        }
	        // 添加定时任务
	        function addScheduledTask() {
	            const nextSendTime = document.getElementById('addScheduledTaskNextSend').value;
	            const taskData = {
	                name: document.getElementById('addScheduledTaskName').value,
	                content: document.getElementById('addScheduledTaskContent').value,
	                chat_ids: document.getElementById('addScheduledTaskChatIds').value.split(',').map(id => id.trim()),
	                interval: parseInt(document.getElementById('addScheduledTaskInterval').value),
	                next_send_time: nextSendTime ? new Date(nextSendTime).toISOString() : new Date().toISOString(),
	                is_active: document.getElementById('addScheduledTaskActive').value === 'true'
	            };
	            showLoading(true);
	            directSupabaseInsertWithServiceKey('scheduled_messages', taskData)
	            .then(() => {
	                showAlert('定时任务添加成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('addScheduledTaskModal')).hide();
	                loadScheduledTasks(currentPage.scheduled);
	            })
	            .catch(error => {
	                showAlert('添加定时任务失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 编辑定时任务
	        function editScheduledTask(taskId) {
	            const task = scheduledTasksData.find(t => t.id === taskId);
	            if (!task) return;
	            document.getElementById('editScheduledTaskId').value = task.id;
	            document.getElementById('editScheduledTaskName').value = task.name;
	            document.getElementById('editScheduledTaskContent').value = task.content;
	            document.getElementById('editScheduledTaskChatIds').value = task.chat_ids.join(',');
	            document.getElementById('editScheduledTaskInterval').value = task.interval;
	            // 设置下次发送时间
	            const nextSendTime = new Date(task.next_send_time);
	            nextSendTime.setMinutes(nextSendTime.getMinutes() - nextSendTime.getTimezoneOffset());
	            document.getElementById('editScheduledTaskNextSend').value = nextSendTime.toISOString().slice(0, 16);
	            document.getElementById('editScheduledTaskActive').value = task.is_active ? 'true' : 'false';
	            const modal = new bootstrap.Modal(document.getElementById('editScheduledTaskModal'));
	            modal.show();
	        }
	        // 保存定时任务
	        function saveScheduledTask() {
	            const taskId = document.getElementById('editScheduledTaskId').value;
	            const nextSendTime = document.getElementById('editScheduledTaskNextSend').value;
	            const taskData = {
	                id: parseInt(taskId),
	                name: document.getElementById('editScheduledTaskName').value,
	                content: document.getElementById('editScheduledTaskContent').value,
	                chat_ids: document.getElementById('editScheduledTaskChatIds').value.split(',').map(id => id.trim()),
	                interval: parseInt(document.getElementById('editScheduledTaskInterval').value),
	                next_send_time: nextSendTime ? new Date(nextSendTime).toISOString() : new Date().toISOString(),
	                is_active: document.getElementById('editScheduledTaskActive').value === 'true'
	            };
	            showLoading(true);
	            directSupabaseUpsertWithServiceKey('scheduled_messages', taskData, 'id')
	            .then(() => {
	                showAlert('定时任务保存成功', 'success');
	                bootstrap.Modal.getInstance(document.getElementById('editScheduledTaskModal')).hide();
	                loadScheduledTasks(currentPage.scheduled);
	            })
	            .catch(error => {
	                showAlert('保存定时任务失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 删除定时任务
	        function deleteScheduledTask(taskId) {
	            if (!confirm('确定要删除这个定时任务吗？')) return;
	            showLoading(true);
	            directSupabaseDeleteWithServiceKey('scheduled_messages', taskId)
	            .then(() => {
	                showAlert('定时任务删除成功', 'success');
	                loadScheduledTasks(currentPage.scheduled);
	            })
	            .catch(error => {
	                showAlert('删除定时任务失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 触发定时任务
	        function triggerScheduledTask(taskId) {
	            if (!confirm('确定要立即触发这个定时任务吗？')) return;
	            showLoading(true);
	            // 调用触发任务的API
	            fetch(`${API_BASE_URL}/api/scheduled/${taskId}/trigger`, {
	                method: 'POST',
	                headers: {
	                    'Content-Type': 'application/json'
	                }
	            })
	            .then(response => {
	                if (response.ok) {
	                    showAlert('定时任务触发成功', 'success');
	                    loadScheduledTasks(currentPage.scheduled);
	                } else {
	                    return response.text().then(text => {
	                        throw new Error(text || '触发失败');
	                    });
	                }
	            })
	            .catch(error => {
	                showAlert('触发定时任务失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 加载系统设置
	        function loadSettings() {
	            // 更新服务器时间
	            document.getElementById('serverTime').textContent = new Date().toLocaleString();
	            // 更新机器人状态
	            document.getElementById('currentBotStatus').textContent = '运行中';
	            document.getElementById('botStatusSwitch').checked = true;
	        }
	        // 切换机器人状态
	        function toggleBotStatus() {
	            const newStatus = !document.getElementById('botStatusSwitch').checked;
	            showLoading(true);
	            // 这里只是模拟切换状态，实际需要修改代码中的EMERGENCY_STOP变量
	            // 由于Worker是无状态的，这个功能需要通过其他方式实现
	            showAlert('机器人状态已切换', 'success');
	            document.getElementById('botStatusSwitch').checked = !newStatus;
	            document.getElementById('currentBotStatus').textContent = newStatus ? '已停止' : '运行中';
	            showLoading(false);
	        }
	        // 检查数据库状态
	        function checkDbStatus() {
	            showLoading(true);
	            directSupabaseFetch('users', 'limit=1')
	            .then(() => {
	                document.getElementById('dbStatus').textContent = '已连接';
	                document.getElementById('dbStatus').className = 'badge bg-success';
	                document.getElementById('dbLastCheck').textContent = new Date().toLocaleString();
	                showAlert('数据库连接正常', 'success');
	            })
	            .catch(error => {
	                document.getElementById('dbStatus').textContent = '连接失败';
	                document.getElementById('dbStatus').className = 'badge bg-danger';
	                document.getElementById('dbLastCheck').textContent = new Date().toLocaleString();
	                showAlert('数据库连接失败: ' + error.message, 'danger');
	            })
	            .finally(() => {
	                showLoading(false);
	            });
	        }
	        // 渲染分页
	        function renderPagination(type, totalItems, currentPage) {
	            const totalPages = Math.ceil(totalItems / itemsPerPage);
	            let html = '';
	            // 上一页
	            html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
	                <a class="page-link" href="#" onclick="changePage('${type}', ${currentPage - 1})">上一页</a>
	            </li>`;
	            // 页码
	            for (let i = 1; i <= totalPages; i++) {
	                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
	                    html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
	                        <a class="page-link" href="#" onclick="changePage('${type}', ${i})">${i}</a>
	                    </li>`;
	                } else if (i === currentPage - 2 || i === currentPage + 2) {
	                    html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
	                }
	            }
	            // 下一页
	            html += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
	                <a class="page-link" href="#" onclick="changePage('${type}', ${currentPage + 1})">下一页</a>
	            </li>`;
	            document.getElementById(type + 'Pagination').innerHTML = html;
	        }
	        // 切换页面
	        function changePage(type, page) {
	            currentPage[type] = page;
	            switch(type) {
	                case 'users':
	                    renderUsersTable();
	                    break;
	                case 'teachers':
	                    renderTeachersTable();
	                    break;
	                case 'keywords':
	                    renderKeywordsTable();
	                    break;
	                case 'banned':
	                    renderBannedTable();
	                    break;
	                case 'scheduled':
	                    renderScheduledTasksTable();
	                    break;
	            }
	        }
	        // 获取状态徽章
	        function getStatusBadge(status) {
	            switch(status) {
	                case 'pending':
	                    return '<span class="badge bg-warning">待审核</span>';
	                case 'approved':
	                    return '<span class="badge bg-success">已通过</span>';
	                case 'rejected':
	                    return '<span class="badge bg-danger">已拒绝</span>';
	                default:
	                    return '<span class="badge bg-secondary">未知</span>';
	            }
	        }
	        // 直接从Supabase获取数据
	        async function directSupabaseFetch(table, filter = "") {
	            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${filter}`, {
	                headers: {
	                    'apikey': SUPABASE_KEY,
	                    'Authorization': `Bearer ${SUPABASE_KEY}`,
	                    'Content-Type': 'application/json'
	                }
	            });
	            if (!response.ok) {
	                const errorData = await response.json().catch(() => ({}));
	                throw new Error(`Supabase错误: ${errorData.message || response.statusText}`);
	            }
	            return await response.json();
	        }
	        // 使用服务角色密钥从Supabase获取数据
	        async function directSupabaseFetchWithServiceKey(table, filter = "") {
	            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${filter}`, {
	                headers: {
	                    'apikey': SUPABASE_SERVICE_KEY,
	                    'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
	                    'Content-Type': 'application/json'
	                }
	            });
	            if (!response.ok) {
	                const errorData = await response.json().catch(() => ({}));
	                throw new Error(`Supabase错误: ${errorData.message || response.statusText}`);
	            }
	            return await response.json();
	        }
	        // 直接向Supabase插入数据
	        async function directSupabaseInsert(table, data) {
	            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
	                method: 'POST',
	                headers: {
	                    'apikey': SUPABASE_KEY,
	                    'Authorization': `Bearer ${SUPABASE_KEY}`,
	                    'Content-Type': 'application/json'
	                },
	                body: JSON.stringify(data)
	            });
	            if (!response.ok) {
	                const errorData = await response.json().catch(() => ({}));
	                throw new Error(`Supabase insert错误: ${errorData.message || response.statusText}`);
	            }
	        }
	        // 使用服务角色密钥插入数据
	        async function directSupabaseInsertWithServiceKey(table, data) {
	            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
	                method: 'POST',
	                headers: {
	                    'apikey': SUPABASE_SERVICE_KEY,
	                    'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
	                    'Content-Type': 'application/json'
	                },
	                body: JSON.stringify(data)
	            });
	            if (!response.ok) {
	                const errorData = await response.json().catch(() => ({}));
	                throw new Error(`Supabase insert错误: ${errorData.message || response.statusText}`);
	            }
	        }
	        // 直接向Supabase更新数据
	        async function directSupabaseUpsert(table, data, conflictColumn) {
	            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?on_conflict=${conflictColumn}`, {
	                method: 'POST',
	                headers: {
	                    'apikey': SUPABASE_KEY,
	                    'Authorization': `Bearer ${SUPABASE_KEY}`,
	                    'Content-Type': 'application/json',
	                    'Prefer': 'resolution=merge-duplicates'
	                },
	                body: JSON.stringify(data)
	            });
	            if (!response.ok) {
	                const errorData = await response.json().catch(() => ({}));
	                throw new Error(`Supabase upsert错误: ${errorData.message || response.statusText}`);
	            }
	        }
	        // 使用服务角色密钥更新数据
	        async function directSupabaseUpsertWithServiceKey(table, data, conflictColumn) {
	            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?on_conflict=${conflictColumn}`, {
	                method: 'POST',
	                headers: {
	                    'apikey': SUPABASE_SERVICE_KEY,
	                    'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
	                    'Content-Type': 'application/json',
	                    'Prefer': 'resolution=merge-duplicates'
	                },
	                body: JSON.stringify(data)
	            });
	            if (!response.ok) {
	                const errorData = await response.json().catch(() => ({}));
	                throw new Error(`Supabase upsert错误: ${errorData.message || response.statusText}`);
	            }
	        }
	        // 直接从Supabase删除数据
	        async function directSupabaseDelete(table, id) {
	            const idColumn = table === 'users' ? 'user_id' : 'id';
	            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${idColumn}=eq.${id}`, {
	                method: 'DELETE',
	                headers: {
	                    'apikey': SUPABASE_KEY,
	                    'Authorization': `Bearer ${SUPABASE_KEY}`
	                }
	            });
	            if (!response.ok) {
	                const errorData = await response.json().catch(() => ({}));
	                throw new Error(`Supabase delete错误: ${errorData.message || response.statusText}`);
	            }
	        }
	        // 使用服务角色密钥删除数据
	        async function directSupabaseDeleteWithServiceKey(table, id) {
	            const idColumn = table === 'users' ? 'user_id' : 'id';
	            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${idColumn}=eq.${id}`, {
	                method: 'DELETE',
	                headers: {
	                    'apikey': SUPABASE_SERVICE_KEY,
	                    'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`
	                }
	            });
	            if (!response.ok) {
	                const errorData = await response.json().catch(() => ({}));
	                throw new Error(`Supabase delete错误: ${errorData.message || response.statusText}`);
	            }
	        }
	        // 显示提示
	        function showAlert(message, type = 'info') {
	            const alertContainer = document.getElementById('alertContainer');
	            const alertId = 'alert-' + Date.now();
	            const alertHtml = `
	                <div id="${alertId}" class="alert alert-${type} alert-dismissible fade show" role="alert">
	                    ${message}
	                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
	                </div>
	            `;
	            alertContainer.insertAdjacentHTML('beforeend', alertHtml);
	            // 自动关闭
	            setTimeout(() => {
	                const alertElement = document.getElementById(alertId);
	                if (alertElement) {
	                    const bsAlert = new bootstrap.Alert(alertElement);
	                    bsAlert.close();
	                }
	            }, 5000);
	        }
	        // 显示/隐藏加载动画
	        function showLoading(show) {
	            document.getElementById('loadingSpinner').style.display = show ? 'flex' : 'none';
	        }
	    </script>
	</body>
	</html>
